<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CineChain Dashboard</title>
    
    <!-- External Links for CineChain & MovBot -->
    <link rel="stylesheet" href="cinechain.css" />
    <script src="cinechain.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Font Awesome for chat icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    
    <style>
      /* ------------------------------------------------------------------- */
      /* START: CINECHAIN DASHBOARD STYLES (New Styles Applied) */
      /* ------------------------------------------------------------------- */
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f6fa; /* Updated background */
      }

      .Sidebar {
        height: 100vh;
        width: 300px;
        position: fixed;
        top: 0;
        left: 0;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: #fff;
        padding-top: 20px;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .Sidebar ul {
        list-style-type: none;
        padding: 0;
      }

      .Sidebar li {
        padding: 15px 20px;
        cursor: pointer;
        transition: background 0.2s, color 0.2s, transform 0.2s;
        border-radius: 8px;
        margin: 8px 12px;
        position: relative;
      }

      .Sidebar a {
        text-decoration: none;
        color: inherit;
        display: block;
        width: 100%;
        height: 100%;
      }

      .Sidebar li:hover {
        background: linear-gradient(90deg, #4e54c8 0%, #8f94fb 100%);
        color: #fff;
        transform: translateX(8px) scale(1.05);
        box-shadow: 0 2px 8px rgba(78, 84, 200, 0.15);
      }

      .Sidebar li.selected {
        background: linear-gradient(90deg, #ff512f 0%, #dd2476 100%);
        color: #fff;
        font-weight: bold;
        box-shadow: 0 2px 12px rgba(221, 36, 118, 0.15);
        border-left: 6px solid #fff;
        transform: translateX(12px) scale(1.07);
      }

      main {
        margin-left: 320px;
        padding: 32px;
      }

      .metric {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(30, 60, 114, 0.08);
        padding: 24px 32px;
        min-width: 220px;
        text-align: center;
        flex: 1;
      }

      .metric:hover {
        box-shadow: 0 4px 24px rgba(30, 60, 114, 0.12);
        transform: translateY(-4px);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .metric h2 {
        margin: 0 0 12px 0;
        font-size: 1.2em;
        color: #2a5298;
      }

      .metric p {
        font-size: 2em;
        margin: 0;
        font-weight: bold;
        color: #222;
      }

      #dashboard h1 {
        color: #1e3c72;
        margin-bottom: 32px;
      }

      canvas {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(30, 60, 114, 0.08);
      }

      canvas#revenueChart {
        background: #fff;
        border-radius: 18px;
        box-shadow: 0 4px 24px rgba(30, 60, 114, 0.18);
        margin: 0 auto;
        display: block;
        border: 2px solid #2a5298;
      }

      #dashboard > div:last-child {
        padding: 32px;
        background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        border-radius: 24px;
        box-shadow: 0 8px 32px rgba(30, 60, 114, 0.12);
        margin-top: 40px;
      }

      #movies, #platforms {
        color: #1e3c72;
        margin-bottom: 32px;
      }

      .card {
        background: white;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-width: 220px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        background-color: #e4eeff;
      }

      .movie-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
      }

      .movie-card img {
        width: 120px;
        height: auto;
        border-radius: 10px;
        flex-shrink: 0;
      }

      .movie-info {
        flex: 1;
      }

      /* --- New Feature Styles --- */
      .feature-section {
        margin-top: 48px;
        margin-bottom: 48px;
        padding: 32px;
        background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        border-radius: 24px;
        box-shadow: 0 8px 32px rgba(30, 60, 114, 0.12);
      }

      .feature-section h2 {
        color: #2a5298;
        margin-bottom: 18px;
      }

      #geoMap {
        width: 100%;
        height: 400px;
        border-radius: 18px;
        margin-bottom: 24px;
        box-shadow: 0 4px 24px rgba(30, 60, 114, 0.18);
        border: 2px solid #2a5298;
      }

      #ticketTrail {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 24px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(30, 60, 114, 0.08);
      }

      #ticketTrail th, #ticketTrail td {
        padding: 12px 16px;
        border-bottom: 1px solid #cfdef3;
        text-align: left;
      }

      #ticketTrail th {
        background: #e0eafc;
        color: #2a5298;
      }

      #ticketTrail tr:last-child td {
        border-bottom: none;
      }

      #stakeholderSelector {
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid #ccc;
        font-size: 1em;
        margin-bottom: 12px;
      }

      #stakeholderReport {
        margin-bottom: 18px;
        font-size: 1.1em;
        color: #1e3c72;
      }

      .compliance-ok {
        color: green;
        font-weight: bold;
      }

      .compliance-fail {
        color: red;
        font-weight: bold;
      }

      #trustboard {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(30, 60, 114, 0.08);
        padding: 24px 32px;
        margin-top: 24px;
        text-align: center;
        color: #2a5298;
        font-weight: bold;
      }
      /* ------------------------------------------------------------------- */
      /* END: CINECHAIN DASHBOARD STYLES */
      /* ------------------------------------------------------------------- */



      /* ------------------------------------------------------------------- */
      /* START: MOV BOT WIDGET STYLES (Kept separate for fixed positioning) */
      /* ------------------------------------------------------------------- */
      
      /* --- 1. Floating Toggle Button (MOV BOT) --- */
      .chat-toggle-button {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #5b6bff;
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        transition: transform 0.3s, background-color 0.3s, opacity 0.3s;
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* --- 2. Chat Pop-up Container (MOV BOT) --- */
      .chat-container {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 90%;
        max-width: 350px;
        height: 450px;
        background-color: #fff;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: all 0.3s ease-in-out;
        transform: translateY(10px);
        opacity: 0;
        z-index: 999;
        pointer-events: none;
      }

      .chat-container:not(.hidden) {
        transform: translateY(0);
        opacity: 1;
        pointer-events: auto;
      }

      .chat-container.hidden {
        transform: translateY(100px);
        opacity: 0;
      }

      .chat-header {
        background-color: #5b6bff;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .chat-header h1 {
        margin: 0;
        font-size: 1.1em;
        flex-grow: 1;
        text-align: center;
        padding-left: 20px; 
      }

      #chat-close-button {
        background: none;
        border: none;
        color: white;
        font-size: 1.2em;
        cursor: pointer;
        padding: 0;
        width: 20px;
        height: 20px;
        line-height: 1;
      }

      .chat-messages {
        flex-grow: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .message {
        max-width: 85%;
        padding: 10px 15px;
        border-radius: 18px;
        font-size: 0.9em;
      }

      .user-message {
        background-color: #e1ffc7;
        align-self: flex-end;
        border-bottom-right-radius: 5px;
      }

      .bot-message {
        background-color: #f0f0f0;
        align-self: flex-start;
        border-bottom-left-radius: 5px;
      }

      .chat-input {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
        background-color: #fff;
      }

      #user-input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 20px;
        outline: none;
        font-size: 0.9em;
      }

      #send-button {
        background-color: #5b6bff;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 20px;
        margin-left: 8px;
        cursor: pointer;
        font-size: 1em;
      }

      /* --- Mobile Responsiveness --- */
      @media (max-width: 600px) {
        .chat-container {
          width: 100%;
          max-width: 100%;
          height: 100%;
          bottom: 0;
          right: 0;
          border-radius: 0;
        }

        .chat-toggle-button {
          bottom: 10px;
          right: 10px;
          width: 50px;
          height: 50px;
          font-size: 20px;
        }
      }
      /* ------------------------------------------------------------------- */
      /* END: MOV BOT WIDGET STYLES */
      /* ------------------------------------------------------------------- */
    </style>
  </head>
  <body>
    <!-- ----------------------------------------------------- -->
    <!-- START: CINECHAIN DASHBOARD CONTENT -->
    <!-- ----------------------------------------------------- -->
    <nav class="Sidebar">
      <ul>
        <h1 style="margin-left: 20px">CineChain</h1>
        <li class="selected"><a href="#dashboard">Dashboard</a></li>
        <li><a href="#movies">Movies</a></li>
        <li><a href="#platforms">Platforms</a></li>
        <li><a href="#stakeholderSpotlight">Stakeholders</a></li>
        <li><a href="#reward">Reward (AI Model)</a></li>
      </ul>
    </nav>
    <main>
      <!-- Reward Section -->
      <section id="reward" class="feature-section">
        <h2>Reward: Add AI Model</h2>
        <p>
          Integrate an AI model to analyze ticket sales, predict audience
          trends, and recommend optimal distribution strategies. Unlock advanced
          insights and earn platform rewards for contributing AI solutions!
        </p>
        <button
          style="
            padding: 12px 24px;
            border-radius: 8px;
            background: #2a5298;
            color: #fff;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
          "
        >
          Add AI Model
        </button>
      </section>

      <!-- Dashboard Metrics -->
      <section id="dashboard">
        <h1>Dashboard</h1>
        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <div class="metric">
            <h2>Movies Distributing</h2>
            <p id="moviesDistributing">0</p>
          </div>
          <div class="metric">
            <h2>Total Attendance</h2>
            <p id="totalAttendance">0</p>
          </div>
          <div class="metric">
            <h2>Active Channels</h2>
            <p id="activeChannels">0</p>
          </div>
          <div class="metric">
            <h2>Total Revenue</h2>
            <p id="totalRevenue">$50</p>
          </div>
        </div>
        <div style="margin-top: 40px">
          <div
            style="
              display: flex;
              align-items: center;
              gap: 16px;
              margin-bottom: 16px;
            "
          >
            <h2 style="margin: 0">Revenue Performance</h2>
            <select
              id="monthSelector"
              style="
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px solid #ccc;
                font-size: 1em;
              "
            ></select>
          </div>
          <canvas id="revenueChart" width="1000" height="400"></canvas>
        </div>
      </section>

      <!-- Other Dashboard Features -->
      <section class="feature-section" id="boxOfficePulse">
        <h2>Box Office Pulse</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <div class="metric">
            <h2>Ticket Sales</h2>
            <p id="ticketSales">0</p>
          </div>
          <div class="metric">
            <h2>Audience Trend</h2>
            <p id="audienceTrend">0%</p>
          </div>
        </div>
      </section>

      <section class="feature-section" id="channelClarity">
        <h2>Channel Clarity</h2>
        <ul>
          <li>Cinemas: 120</li>
          <li>Streaming: 5 platforms</li>
          <li>Digital: 3 platforms</li>
        </ul>
      </section>

      <section class="feature-section" id="stakeholderSpotlight">
        <h2>Stakeholder Spotlight</h2>
        <select id="stakeholderSelector">
          <option value="producer">Producer</option>
          <option value="distributor">Distributor</option>
          <option value="theater">Theater Owner</option>
        </select>
        <div id="stakeholderReport">
          Producer: View earnings, movie reach, and feedback.
        </div>
      </section>

      <section class="feature-section" id="geoMapDistribution">
        <h2>Geo-Map Distribution</h2>
        <div id="geoMap"></div>
      </section>

      <section class="feature-section" id="ticketTrailSection">
        <h2>Ticket Trail</h2>
        <table id="ticketTrail">
          <tr>
            <th>Movie</th>
            <th>Release</th>
            <th>Sold</th>
            <th>Status</th>
          </tr>
          <tr>
            <td>Interstellar</td>
            <td>2025-09-01</td>
            <td>5000</td>
            <td>Verified</td>
          </tr>
          <tr>
            <td>Inception</td>
            <td>2025-08-15</td>
            <td>4200</td>
            <td>Verified</td>
          </tr>
          <tr>
            <td>The Dark Knight</td>
            <td>2025-07-20</td>
            <td>3900</td>
            <td>Verified</td>
          </tr>
        </table>
      </section>

      <section class="feature-section" id="releaseRadar">
        <h2>Release Radar</h2>
        <div id="releaseAlerts"></div>
      </section>

      <section class="feature-section" id="revenueReveal">
        <h2>Revenue Reveal</h2>
        <ul>
          <li>Cinemas: $120,000</li>
          <li>Streaming: $80,000</li>
          <li>Digital: $30,000</li>
        </ul>
      </section>

      <section class="feature-section" id="audienceAnalytics">
        <h2>Audience Analytics</h2>
        <p>Age 18-25: 40% | Age 26-40: 35% | Age 41+: 25%</p>
        <p>Feedback: "Loved the movie!"</p>
      </section>

      <section class="feature-section" id="complianceChecker">
        <h2>Compliance Checker</h2>
        <p>All channels: <span class="compliance-ok">Compliant</span></p>
      </section>

      <section id="trustboard">
        <h2>Transparency Trustboard</h2>
        <p>Verified numbers and fair distribution for all stakeholders.</p>
      </section>

      <section id="movies">
        <h1>Movies</h1>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="card movie-card">
              <div class="movie-info">
                <h3>Top Movie</h3>
                <p>Movie: <strong>Interstellar</strong></p>
                <p>Revenue: $150,000</p>
                <p>Rating: 9.2/10</p>
              </div>
              <img src="images/interstellar.webp" alt="Interstellar Poster" />
            </div>
            <div class="card movie-card">
              <div class="movie-info">
                <h3>Second Movie</h3>
                <p>Movie: <strong>Inception</strong></p>
                <p>Revenue: $120,000</p>
                <p>Rating: 8.9/10</p>
              </div>
              <img src="images/inception.webp" alt="Inception Poster" />
            </div>
            <div class="card movie-card">
              <div class="movie-info">
                <h3>Third Movie</h3>
                <p>Movie: <strong>The Dark Knight</strong></p>
                <p>Revenue: $110,000</p>
                <p>Rating: 9.0/10</p>
              </div>
              <img src="images/darkknight.webp" alt="The Dark Knight Poster" />
            </div>
        </div>
      </section>

      <section id="platforms">
        <h1>Platforms</h1>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div class="card">
              <h3>Top Platform</h3>
              <p>Platform: <strong>Netflix</strong></p>
              <p>Movies Hosted: 150</p>
              <p>Total Views: 1,200,000</p>
            </div>
            <div class="card">
              <h3>Second Platform</h3>
              <p>Platform: <strong>Amazon Prime</strong></p>
              <p>Movies Hosted: 120</p>
              <p>Total Views: 950,000</p>
            </div>
            <div class="card">
              <h3>Third Platform</h3>
              <p>Platform: <strong>Disney+</strong></p>
              <p>Movies Hosted: 100</p>
              <p>Total Views: 800,000</p>
            </div>
        </div>
      </section>
    </main>
    <!-- ----------------------------------------------------- -->
    <!-- END: CINECHAIN DASHBOARD CONTENT -->
    <!-- ----------------------------------------------------- -->

    <!-- ----------------------------------------------------- -->
    <!-- START: MOV BOT CHAT WIDGET -->
    <!-- ----------------------------------------------------- -->
    <button id="chat-toggle-button" class="chat-toggle-button">
      <i class="fas fa-comment"></i>
    </button>
    <div id="chat-container" class="chat-container hidden">
      <div class="chat-header">
        <h1>MovBot - Your Movie Assistant</h1>
        <button id="chat-close-button" title="Close Chat">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="message bot-message">
          <div class="message-content">
            Hi there! I'm MovBot, your movie assistant. How can I help you
            today?
          </div>
        </div>
      </div>
      <div class="chat-input">
        <input
          type="text"
          id="user-input"
          placeholder="Ask me about movies..."
        />
        <button id="send-button"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
    <!-- ----------------------------------------------------- -->
    <!-- END: MOV BOT CHAT WIDGET -->
    <!-- ----------------------------------------------------- -->


    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- CHAT WIDGET ELEMENTS ---
        const chatContainer = document.getElementById('chat-container');
        const chatToggleButton = document.getElementById('chat-toggle-button');
        const chatCloseButton = document.getElementById('chat-close-button');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const chatMessages = document.getElementById('chat-messages');

        // --- DASHBOARD ELEMENTS & UTILITY ---
        const items = document.querySelectorAll('.Sidebar li');
        const stakeholderSelector = document.getElementById('stakeholderSelector');
        const stakeholderReport = document.getElementById('stakeholderReport');
        const monthSelector = document.getElementById('monthSelector');
        
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // --- 1. DASHBOARD INITIALIZATION & LOGIC ---

        // Sidebar selection logic
        items.forEach(item => {
            item.addEventListener('click', function() {
                items.forEach(i => i.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // Dashboard metrics update
        function updateMetrics() {
            document.getElementById('totalRevenue').textContent = '$' + getRandomInt(50000, 200000).toLocaleString();
            document.getElementById('totalAttendance').textContent = getRandomInt(1000, 10000).toLocaleString();
            document.getElementById('activeChannels').textContent = getRandomInt(5, 100);
            document.getElementById('moviesDistributing').textContent = getRandomInt(10, 50);
            // Box Office Pulse metrics
            document.getElementById('ticketSales').textContent = getRandomInt(1000, 50000).toLocaleString();
            document.getElementById('audienceTrend').textContent = getRandomInt(1, 100) + '%';
        }
        updateMetrics();
        setInterval(updateMetrics, 5000);

        // Revenue chart logic
        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        
        for (let i = 0; i < 12; i++) {
            let date = new Date(currentYear, currentMonth - i, 1);
            let value = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2, '0')}`;
            let text = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;
            let option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            if (i === 0) option.selected = true;
            monthSelector.appendChild(option);
        }
        
        // --- Chart initialization ---
        // Note: The Chart object requires a valid canvas element to be present in the DOM.
        try {
          const ctx = document.getElementById('revenueChart').getContext('2d');
          const days = Array.from({length: 30}, (_, i) => `Day ${i+1}`);
          const revenueData = Array.from({length: 30}, () => getRandomInt(1000, 10000));
          
          const revenueChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: days,
                  datasets: [{
                      label: 'Revenue',
                      data: revenueData,
                      backgroundColor: days.map(() => 'rgba(46, 83, 201, 0.7)'),
                      borderColor: days.map(() => '#ff512f'),
                      borderWidth: 2,
                      borderRadius: 8,
                      hoverBackgroundColor: 'rgba(221,36,118,0.7)'
                  }]
              },
              options: {
                  responsive: false,
                  plugins: {
                      legend: { display: true },
                      title: {
                          display: true,
                          text: 'Monthly Revenue Trend',
                          font: { size: 24 }
                      },
                      tooltip: {
                          enabled: true,
                          backgroundColor: '#2a5298',
                          titleColor: '#fff',
                          bodyColor: '#fff'
                      }
                  },
                  scales: {
                      x: {
                          display: true,
                          title: { display: true, text: 'Day of Month', font: { size: 18 } },
                          grid: { color: '#cfdef3' }
                      },
                      y: {
                          display: true,
                          title: { display: true, text: 'Revenue ($)', font: { size: 18 } },
                          grid: { color: '#cfdef3' }
                      }
                  }
              }
          });
          
          monthSelector.addEventListener('change', function() {
              revenueChart.data.datasets[0].data = Array.from({length: 30}, () => getRandomInt(1000, 10000));
              revenueChart.update();
          });
        } catch (e) {
            console.error("Chart.js failed to initialize:", e);
        }


        // Stakeholder Spotlight logic
        stakeholderSelector.addEventListener('change', function() {
            const role = this.value;
            let report = '';
            if (role === 'producer') report = 'Producer: View earnings, movie reach, and feedback.';
            if (role === 'distributor') report = 'Distributor: See channel performance and compliance.';
            if (role === 'theater') report = 'Theater Owner: Analyze ticket sales and audience demographics.';
            stakeholderReport.textContent = report;
        });

        // Geo-Map Distribution (Requires Leaflet to be loaded)
        if (window.L) {
            try {
                const map = L.map('geoMap').setView([51.505, -0.09], 2);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
                L.marker([51.5, -0.09]).addTo(map).bindPopup('London Cinema');
                L.marker([40.7, -74.0]).addTo(map).bindPopup('New York Cinema');
                L.marker([35.68, 139.76]).addTo(map).bindPopup('Tokyo Cinema');
            } catch (e) {
                console.error("Leaflet map failed to initialize:", e);
            }
        }

        // Release Radar alerts
        function showReleaseAlert(movie) {
            const releaseAlerts = document.getElementById('releaseAlerts');
            const alertDiv = document.createElement('div');
            alertDiv.textContent = `New Release: ${movie.title} on ${movie.date}`;
            alertDiv.style.background = '#e0eafc';
            alertDiv.style.padding = '8px 12px';
            alertDiv.style.marginBottom = '8px';
            alertDiv.style.borderRadius = '8px';
            releaseAlerts.appendChild(alertDiv);
        }
        showReleaseAlert({title: 'Tenet', date: '2025-10-10'});
        showReleaseAlert({title: 'Dune', date: '2025-11-05'});
        
        
        // --- 2. CHAT WIDGET LOGIC ---

        // Function to handle toggling/closing the chat
        function toggleChat() {
          const isHidden = chatContainer.classList.toggle('hidden');
          if (isHidden) {
            // Chat is hidden: SHOW the toggle button
            chatToggleButton.style.display = 'flex';
          } else {
            // Chat is visible: HIDE the toggle button and focus input
            chatToggleButton.style.display = 'none';
            userInput.focus();
          }
        }

        chatToggleButton.addEventListener('click', toggleChat);
        chatCloseButton.addEventListener('click', toggleChat);

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (event) => {
          if (event.key === 'Enter') {
            sendMessage();
          }
        });

        async function sendMessage() {
          const messageText = userInput.value.trim();
          if (messageText === '') return;
          displayMessage(messageText, 'user');
          userInput.value = '';
          try {
            const response = await fetch('/chat', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: messageText }),
            });
            const data = await response.json();
            displayMessage(data.reply, 'bot');
          } catch (error) {
            console.error('Error fetching chat response:', error);
            displayMessage(
              'MovBot is having trouble connecting to the chat API. (Ensure Python backend is running)',
              'bot'
            );
          }
        }

        function displayMessage(text, sender) {
          const messageDiv = document.createElement('div');
          messageDiv.classList.add('message');
          messageDiv.classList.add(sender + '-message');
          const messageContentDiv = document.createElement('div');
          messageContentDiv.classList.add('message-content');
          messageContentDiv.textContent = text;
          messageDiv.appendChild(messageContentDiv);
          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      });
    </script>
  </body>
</html>

